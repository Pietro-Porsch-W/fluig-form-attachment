;(function($){"use strict";var b='fluigFormAttachment',c=item=>typeof item==='string',d={showActionButton:!0,filename:'Anexo',prefixName:!1,accept:'*'},e=['isValid','hasAttachment'];class Plugin{#settings;#input;#container;#attachmentFilename;constructor(a,A){this.#settings=$.extend({},d,A);this.#input=$(a);this.#attachmentFilename=this.#input.val()||this.#input.text().trim();this.#input.prop('readonly',!0).on('change',()=>{this.#attachmentFilename=this.#input.val();this.#changeButtonsState()}).wrap(`<div class="${b}Component"></div>`).after(`<div class="${b}Component_buttons">${this.#getButtonsTemplate()}</div>`);this.#container=this.#input.closest(`.${b}Component`);this.#container.on('click',`.${b}BtnDeleteFile`,()=>this.#confirmDeleteAttachment()).on('click',`.${b}BtnUpuloadFile`,()=>this.#uploadAttachment()).on('click',`.${b}BtnViewerFile`,()=>this.#viewAttachment())}isValid(){return this.#attachmentFilename.length?this.hasAttachment():!0}hasAttachment(){var _=this.#attachmentFilename||this.#input.val()||this.#input.text().trim();return _.length>0&&parent.ECM.attachmentTable.getData().findIndex(B=>B.description===_)!==-1}deleteAttachment(){var C=parent.ECM.attachmentTable.getData().findIndex(_a=>_a.description===this.#attachmentFilename);setTimeout(()=>this.#input.val('').trigger('change'),500);if(C===-1)return;parent.WKFViewAttachment.removeAttach([C])}#getButtonsTemplate(){var D=this.#attachmentFilename.length!==0,_b=this.#input.get(0);let _c='';(this.#settings.showActionButton&&_b.nodeName.toLowerCase()==='input'&&!_b.disabled)&&(_c+=D?`<button type="button" class="${b}BtnAction ${b}BtnDeleteFile btn btn-danger btn-sm" title="Remover Anexo"><i class="flaticon flaticon-trash icon-sm"></i></button>`:`<button type="button" class="${b}BtnAction ${b}BtnUpuloadFile btn btn-success btn-sm" title="Enviar Anexo"><i class="flaticon flaticon-upload icon-sm"></i></button>`);_c+=`<button type="button" class="${b}BtnViewerFile btn btn-info btn-sm" ${D?'':'style="display:none"'} title="Visualizar Anexo"><i class="flaticon flaticon-view icon-sm"></i></button>`;return _c}#changeButtonsState(){var _A=this.#attachmentFilename.length!==0;if(this.#settings.showActionButton){var _B=[];let E='';let aA='';_A?(_B.push(`${b}BtnDeleteFile`),_B.push('btn-danger'),E='flaticon-trash',aA='Remover Anexo'):(_B.push(`${b}BtnUpuloadFile`),_B.push('btn-success'),E='flaticon-upload',aA='Enviar Anexo');this.#container.find(`.${b}BtnAction`).removeClass([`${b}BtnUpuloadFile`,`${b}BtnDeleteFile`,'btn-danger','btn-success']).addClass(_B).attr('title',aA).trigger('blur').find('i').removeClass(['flaticon-trash','flaticon-upload']).addClass(E)}_A?this.#container.find(`.${b}BtnViewerFile`).show():this.#container.find(`.${b}BtnViewerFile`).hide()}#confirmDeleteAttachment(){FLUIGC.message.confirm({message:`Deseja remover o anexo <b>${this.#attachmentFilename}</b>?`,title:'Confirmação',labelYes:'Sim, quero remover',labelNo:'Não, quero cancelar'},aB=>{if(!aB)return;this.deleteAttachment()})}#uploadAttachment(){let aC=this.#input.data('filename')||this.#settings.filename;if(this.#settings.prefixName===!0)aC=FLUIGC.utilities.randomUUID().substring(0,9)+aC;else (this.#settings.prefixName!==!1&&c(this.#settings.prefixName))&&(aC=`${this.#settings.prefixName}-${aC}`);if(parent.ECM.attachmentTable.getData().findIndex(aD=>aD.description===aC)!==-1){FLUIGC.toast({title:'Atenção',message:'Já existe um anexo com essa descrição',type:'warning'});return}this.#input.val(aC);parent.$('#ecm-navigation-inputFile-clone').attr({'data-on-camera':'true','data-file-name-camera':aC,'data-inputid':this.#input.attr('id'),'multiple':!1,'accept':this.#input.data('accept')||this.#settings.accept}).trigger('click')}#viewAttachment(){var aE=parent.ECM.attachmentTable.getData().findIndex(aG=>aG.description===this.#attachmentFilename);if(aE===-1){FLUIGC.toast({title:'Atenção',message:'Anexo não encontrado',type:'warning'});return}var aF=parent.ECM.attachmentTable.getRow(aE);aF.documentId?parent.WKFViewAttachment.openAttachmentView(parent.WCMAPI.userCode,aF.documentId,aF.version):parent.WKFViewAttachment.downloadAttach([aE])}}$.fn[b]=function(aH){if(!parent.WKFViewAttachment||!parent.ECM||!parent.ECM.attachmentTable){console.error(`Plugin ${b} executado fora de um processo.`);return this}if(c(aH)){var aI=aH;if(e.includes(aI)){var _C=$(this.get(0)),_d=_C.data(b);if(!_d||!_d[aI])return;return _d[aI]()}return this.each(function(){var aJ=$(this).data(b);aJ?.[aI]&&aJ[aI]()})}var _e=$.extend({},d,aH);return this.each(function(){!$.data(this,b)&&$.data(this,b,new Plugin(this, _e))})};if(!parent.WKFViewAttachment||!parent.ECM||!parent.ECM.attachmentTable)return;$(()=>{$('#tab-attachments',parent.document).hide();parent.$('#ecm_navigation_fileupload').on(`fileuploaddone.${b}`,function(){var aK=parent.document.getElementById('ecm-navigation-inputFile-clone').getAttribute('data-inputid'),aL=$(`#${aK}`);!aL.fluigFormAttachment('hasAttachment')&&aL.val('');aL.trigger('change')})});$('head').append(`<style>
.${b}Component {
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
}
.${b}Component input {
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
}
.${b}Component_buttons {
    display: flex;
    align-items: center;
    justify-content: flex-end;
}
.${b}Component_buttons .btn {
    outline: none !important;
    outline-offset: unset !important;
    border-radius: 0 !important;
    height: 32px;
}
</style>`)}(jQuery));
