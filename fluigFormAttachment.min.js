;(function($){"use strict";var b='fluigFormAttachment',c=item=>typeof item==='string',d={showActionButton:!0,filename:'Anexo',prefixName:!1,accept:'*'},e=['isValid','hasAttachment'];class Plugin{#settings;#input;#container;#attachmentFilename;constructor(a,A){this.#settings=$.extend({},d,A);this.#input=$(a);this.#attachmentFilename=this.#input.val()||this.#input.text().trim();this.#input.prop('readonly',!0).on('change',()=>{this.#attachmentFilename=this.#input.val();this.#changeButtonsState()}).wrap(`<div class="${b}Component"></div>`).after(`<div class="${b}Component_buttons">${this.#getButtonsTemplate()}</div>`);this.#container=this.#input.closest(`.${b}Component`);this.#container.on('click',`.${b}BtnDeleteFile`,()=>this.#confirmDeleteAttachment()).on('click',`.${b}BtnUpuloadFile`,()=>this.#uploadAttachment()).on('click',`.${b}BtnViewerFile`,()=>this.#viewAttachment())}isValid(){return this.#attachmentFilename.length?this.hasAttachment():!0}hasAttachment(){var _=this.#attachmentFilename||this.#input.val()||this.#input.text().trim();return _.length>0&&parent.ECM.attachmentTable.getData().findIndex(B=>B.description===_)!==-1}deleteAttachment(){var C=parent.ECM.attachmentTable.getData().findIndex(_a=>_a.description===this.#attachmentFilename);setTimeout(()=>this.#input.val('').trigger('change'),500);if(C===-1)return;parent.WKFViewAttachment.removeAttach([C])}#getButtonsTemplate(){var D=this.#attachmentFilename.length!==0;let _b='';this.#canDisplayActionButton()&&(_b+=D?`<button type="button" class="${b}BtnAction ${b}BtnDeleteFile btn btn-danger btn-sm" title="Remover Anexo"><i class="flaticon flaticon-trash icon-sm"></i></button>`:`<button type="button" class="${b}BtnAction ${b}BtnUpuloadFile btn btn-success btn-sm" title="Enviar Anexo"><i class="flaticon flaticon-upload icon-sm"></i></button>`);_b+=`<button type="button" class="${b}BtnViewerFile btn btn-info btn-sm" ${D?'':'style="display:none"'} title="Visualizar Anexo"><i class="flaticon flaticon-view icon-sm"></i></button>`;return _b}#canDisplayActionButton(){var _A=this.#input.get(0);return this.#settings.showActionButton&&_A.nodeName.toLowerCase()==='input'&&!_A.disabled&&parent.ECM.workflowView.userPermissions.indexOf('P')>=0}#changeButtonsState(){var E=this.#attachmentFilename.length!==0;if(this.#canDisplayActionButton()){var _B=[];let aA='';let aB='';E?(_B.push(`${b}BtnDeleteFile`),_B.push('btn-danger'),aA='flaticon-trash',aB='Remover Anexo'):(_B.push(`${b}BtnUpuloadFile`),_B.push('btn-success'),aA='flaticon-upload',aB='Enviar Anexo');this.#container.find(`.${b}BtnAction`).removeClass([`${b}BtnUpuloadFile`,`${b}BtnDeleteFile`,'btn-danger','btn-success']).addClass(_B).attr('title',aB).trigger('blur').find('i').removeClass(['flaticon-trash','flaticon-upload']).addClass(aA)}E?this.#container.find(`.${b}BtnViewerFile`).show():this.#container.find(`.${b}BtnViewerFile`).hide()}#confirmDeleteAttachment(){FLUIGC.message.confirm({message:`Deseja remover o anexo <b>${this.#attachmentFilename}</b>?`,title:'Confirmação',labelYes:'Sim, quero remover',labelNo:'Não, quero cancelar'},aC=>{if(!aC)return;this.deleteAttachment()})}#uploadAttachment(){let aD=this.#input.data('filename')||this.#settings.filename;if(this.#settings.prefixName===!0)aD=FLUIGC.utilities.randomUUID().substring(0,9)+aD;else (this.#settings.prefixName!==!1&&c(this.#settings.prefixName))&&(aD=`${this.#settings.prefixName}-${aD}`);if(parent.ECM.attachmentTable.getData().findIndex(aE=>aE.description===aD)!==-1){FLUIGC.toast({title:'Atenção',message:'Já existe um anexo com essa descrição',type:'warning'});return}parent.$('#ecm-navigation-inputFile-clone').attr({'data-on-camera':'true','data-file-name-camera':aD,'data-inputid':this.#input.attr('id'),'data-filename':aD,'multiple':!1,'accept':this.#input.data('accept')||this.#settings.accept}).trigger('click')}#viewAttachment(){var aF=parent.ECM.attachmentTable.getData().findIndex(aH=>aH.description===this.#attachmentFilename);if(aF===-1){FLUIGC.toast({title:'Atenção',message:'Anexo não encontrado',type:'warning'});return}var aG=parent.ECM.attachmentTable.getRow(aF);aG.documentId?parent.WKFViewAttachment.openAttachmentView(parent.WCMAPI.userCode,aG.documentId,aG.version):parent.WKFViewAttachment.downloadAttach([aF])}}$.fn[b]=function(aI){if(!parent.WKFViewAttachment||!parent.ECM||!parent.ECM.attachmentTable){console.error(`Plugin ${b} executado fora de um processo.`);return this}if(c(aI)){var aJ=aI;if(e.includes(aJ)){var _c=$(this.get(0)),_d=_c.data(b);if(!_d||!_d[aJ])return;return _d[aJ]()}return this.each(function(){var aK=$(this).data(b);aK?.[aJ]&&aK[aJ]()})}var _e=$.extend({},d,aI);return this.each(function(){!$.data(this,b)&&$.data(this,b,new Plugin(this, _e))})};if(!parent.WKFViewAttachment||!parent.ECM||!parent.ECM.attachmentTable)return;var g=FLUIGC.loading(window,{title:'Aguarde',textMessage:'Enviando arquivo'});$(()=>{$('#tab-attachments',parent.document).hide();parent.$('#ecm_navigation_fileupload').on(`fileuploadadd.${b}`,function(e,aL){var _C=aL.files[0];if(parent.ECM.maxUploadSize>0&&_C.size>=(parent.ECM.maxUploadSize*1024*1024))return;if(parent.ECM.newAttachmentsDocs.length&&parent.ECM.newAttachmentsDocs.findIndex(aM=>aM.name===_C.name)!==-1)return;g.show()}).on(`fileuploadfail.${b}`,()=>g.hide()).on(`fileuploaddone.${b}`,function(){g.hide();var aN=parent.document.getElementById('ecm-navigation-inputFile-clone'),aO=aN.getAttribute('data-filename');if(parent.ECM.attachmentTable.getData().findIndex(aP=>aP.description===aO)===-1)return;$(`#${aN.getAttribute('data-inputid')}`).val(aO).trigger('change')});parent.$(document).on(`fileuploadstop.${b}`,()=>g.hide())});$('head').append(`<style>
.${b}Component {
    display: flex;
    align-items: center;
    flex-wrap: nowrap;
}
.${b}Component input {
    border-top-right-radius: 0 !important;
    border-bottom-right-radius: 0 !important;
}
.${b}Component_buttons {
    display: flex;
    align-items: center;
    justify-content: flex-end;
}
.${b}Component_buttons .btn {
    outline: none !important;
    outline-offset: unset !important;
    border-radius: 0 !important;
    height: 32px;
}
</style>`)}(jQuery));
